// pages/calendar/shared-calendar.js
import React, { useState, useEffect } from 'react';
import { Calendar, dateFnsLocalizer } from 'react-big-calendar';
import "react-big-calendar/lib/css/react-big-calendar.css";
import { format, parse, startOfWeek, getDay } from 'date-fns';
import enUS from 'date-fns/locale/en-US';

const locales = { 'en-US': enUS };
const localizer = dateFnsLocalizer({
  format,
  parse,
  startOfWeek: () => startOfWeek(new Date(), { weekStartsOn: 0 }),
  getDay,
  locales,
});

const SharedCalendarPage = () => {
  const [events, setEvents] = useState([]);
  const [showCalendar, setShowCalendar] = useState({
    personal: true,
    family: false,
    work: false,
    friends: false,
  });

  useEffect(() => {
    // Fetch shared calendar events from the backend API
    fetch("/api/events/shared") // Ensure API endpoint is set up for shared events
      .then(res => res.json())
      .then(data => setEvents(data))
      .catch(err => console.error("Error loading events:", err));
  }, []);

  const toggleCalendar = (calendarType) => {
    setShowCalendar((prev) => ({
      ...prev,
      [calendarType]: !prev[calendarType],
    }));
  };

  // Filter events based on toggled calendars
  const filteredEvents = events.filter(event => {
    if (showCalendar.personal && event.type === "personal") return true;
    if (showCalendar.family && event.type === "family") return true;
    if (showCalendar.work && event.type === "work") return true;
    if (showCalendar.friends && event.type === "friends") return true;
    return false;
  });

  return (
    <div className="p-4 bg-gray-100 min-h-screen">
      <h1 className="text-2xl font-bold mb-4">Shared Calendar</h1>
      
      {/* Toggle Buttons for Calendars */}
      <div className="mb-6 flex space-x-2">
        <button
          className={`px-4 py-2 rounded ${showCalendar.personal ? 'bg-blue-600 text-white' : 'bg-gray-300 text-black'}`}
          onClick={() => toggleCalendar("personal")}
        >
          Personal Calendar
        </button>
        <button
          className={`px-4 py-2 rounded ${showCalendar.family ? 'bg-green-600 text-white' : 'bg-gray-300 text-black'}`}
          onClick={() => toggleCalendar("family")}
        >
          Family Calendar
        </button>
        <button
          className={`px-4 py-2 rounded ${showCalendar.work ? 'bg-purple-600 text-white' : 'bg-gray-300 text-black'}`}
          onClick={() => toggleCalendar("work")}
        >
          Work Calendar
        </button>
        <button
          className={`px-4 py-2 rounded ${showCalendar.friends ? 'bg-pink-600 text-white' : 'bg-gray-300 text-black'}`}
          onClick={() => toggleCalendar("friends")}
        >
          Friends Calendar
        </button>
      </div>

      {/* Calendar Component with Filtered Events */}
      <Calendar
        localizer={localizer}
        events={filteredEvents}
        startAccessor="start"
        endAccessor="end"
        style={{ height: 600 }}
        selectable
        popup
      />
    </div>
  );
};

export default SharedCalendarPage;
